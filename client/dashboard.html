<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="styles/main.css">
  <!-- Setup AngularJS -->
  <script src="https://code.angularjs.org/1.4.3/angular.js"></script>
  <script src="js/app.js"></script>
  <script src="js/factories/tweetsFactory.js"></script>
  <script src="js/controllers/tweetsController.js"></script>
  <!-- Setup d3 -->
  <script src="js/uStates.js"></script> <!-- creates uStates. -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <script src="http://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/png" href="etc/favicon.ico">

</head>
<body>

  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <nav class="navbar navbar-default navbar-fixed-top">
          <div class="container-fluid" style="position: relative; margin-top: -10px; margin-bottom: 3px;">
            <h3>Twitter Nation Dashboard
              <div class="btn-group pull-right">
                <button type="button" class="btn btn-regular dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="fas fa-bars"></i>
                </button>
                <div class="dropdown-menu">
                  <span><p class="dropdown-item-text">Account Settings <i class="fas fa-user-circle"></i></p></span>
                  <hr />
                  <span><p class="dropdown-item-text">Privacy <i class="fas fa-lock"></i></p></span>
                  <hr />
                  <span><p class="dropdown-item-text">Contact Us! <i class="fas fa-phone-square"></i></p></span>
                  <hr />
                  <span><p class="dropdown-item-text">Logout <i class="fas fa-sign-out-alt"></i></p></span>
                </div>
              </div>
            </h3>
          </div>
        </nav>
      </div>
    </div>
  </div>


  <div class="container" style="margin-top: 30px;">
    <!-- <div class="container" style="margin-top: 60px;"> -->
    <div class="row">
      <div class="col-md-4">
        <div id="fullmap">
          <div id="tooltip"></div><!-- div to hold tooltip. -->
          <svg width="800" style="margin-left: 125px;" height="600" viewBox="0 0 960 600" id="statesvg"></svg>
          <!-- <svg width="800" style="display: block; margin: 0 auto;" height="600" viewBox="0 0 960 600" id="statesvg"></svg> -->
          <!-- <svg width="960" height="600" style="margin-left:100px;" id="statesvg"></svg> -->

          <script>

          function tooltipHtml(stateName, tweetsADay){ /* function to create html content string in tooltip div. */
            return "<h4>"+ stateName +"</h4><table>"+
            "<tr><td>Tweets:</td><td>"+(tweetsADay)+"</td></tr></table>";
          }

          tweet_data = [];

          d3.csv("etc/twitterVolume.csv", function (data) {
            data.forEach(function (d) {
              tweet_data.push({"state": d.state, "tweetsADay": +d.tweetsADay});
            })
            //console.log(tweet_data);
            //to find max value in an array
            var sampleData = [];  /* Sample random data. */
            start = d3.max([1,d3.min(tweet_data, function(d) {return d.tweetsADay; })]);
            end = 1 + d3.max(tweet_data, function (d) { /*console.log(d);*/ return d.tweetsADay });

            // Log Scale, starting number had to be greater than or equal to 1 to not break color coding
            const logScale = d3.scaleLog()
            .domain([start, end])
            const colorScaleLog = d3.scaleSequential(
              (d) => {
                return d3.interpolateBlues(logScale(d)) }
              )

              tweet_data.forEach(function(d){
                //console.log("d:", d);
                uStatePaths.forEach(function (s) {
                  //console.log("s:", s);
                  if (d.state == s.n) {
                    d.n = s.n;
                    d.d = s.d;
                    d.id = s.id;
                  }
                })

                //console.log(tweet_data)
                tweetsADay = +d.tweetsADay;

                sampleData.push({
                  n: d.n,
                  state: d.state,
                  tweetsADay: tweetsADay,
                  path: d.d,
                  color: colorScaleLog(tweetsADay),
                  oldColor: colorScaleLog(tweetsADay),
                  color2:d3.interpolate("#000000", "#ffffff")(Math.round(tweetsADay)/100)});
                });
                //console.log("sampleData:", sampleData);
                /* draw states on id #statesvg */
                uStates.draw("#statesvg", sampleData, tooltipHtml);
              })
              d3.select(self.frameElement).style("height", "600px");


              </script>

            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="embedTweets" style=" width: 50%; margin: 0 auto; overflow: auto; height: 360px; ">
              <blockquote class="twitter-tweet"><p lang="en" dir="ltr">just setting up my twttr</p>&mdash; jack (@jack) <a href="https://twitter.com/jack/status/20?ref_src=twsrc%5Etfw">March 21, 2006</a></blockquote>
              <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
              <blockquote class="twitter-tweet"><p lang="en" dir="ltr">just setting up my twttr</p>&mdash; jack (@jack) <a href="https://twitter.com/jack/status/20?ref_src=twsrc%5Etfw">March 21, 2006</a></blockquote>
              <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
              <blockquote class="twitter-tweet"><p lang="en" dir="ltr">just setting up my twttr</p>&mdash; jack (@jack) <a href="https://twitter.com/jack/status/20?ref_src=twsrc%5Etfw">March 21, 2006</a></blockquote>
              <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            </div>
          </div>
        </div>
      </div>

      <br />

      <div class="container">
        <div class="row" >
          <div class="hello col-md-6">

            <script>
            var raw;

            var size = Math.min(Math.min(window.innerWidth, window.innerHeight), 400);
            var color = d3.scaleOrdinal(d3.schemeCategory20c);

            var chart = d3.select(".hello")
            .append('svg')
            .attr("width", size)
            .attr("height", size);

            var pack = d3.pack()
            .size([size, size])
            .padding(size*0.005);

            d3.text('https://s3-us-west-2.amazonaws.com/s.cdpn.io/310408/youFailMe.txt', function(error, data) {
              if (error) throw error;

              raw = data.split(/\W+/);

              var keys = [];

              // count the word frequency
              var counts = raw.reduce(function(obj, word) {
                if(!obj[word]) {
                  obj[word] = 0;
                  keys.push(word);
                }
                obj[word]++;
                return obj;
              }, {});

              // sort the keys from highest to lowest
              keys.sort(function(a,b) {
                return counts[b] - counts[a];
              });

              // only keep words used 10 or more times
              // keys = keys.filter(function(key) {
              // 	return counts[key] >= 10 ? key : '';
              // });

              var root = d3.hierarchy({children: keys})
              .sum(function(d) { return counts[d]; });

              var node = chart.selectAll(".node")
              .data(pack(root).leaves())
              .enter().append("g")
              .attr("class", "node")
              .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

              node.append("circle")
              .attr("id", function(d) { return d.data; })
              .attr("r", function(d) { return d.r; })
              .style("fill", function(d) { return color(d.data); });

              node.append("clipPath")
              .attr("id", function(d) { return "clip-" + d.data; })
              .append("use")
              .attr("xlink:href", function(d) { return "#" + d.data; });

              node.append("text")
              .attr("clip-path", function(d) { return "url(#clip-" + d.data + ")"; })
              .append("tspan")
              .attr("x", 0)
              .attr("y", function(d) { return d.r/8; })
              .attr("font-size", function(d) { return d.r/2; })
              .text(function(d) { return d.data; });

            });

            </script>

          </div>
          <div class="world col-md-6">

            <script>

            var margin = {top: 20, right: 20, bottom: 30, left: 40},
            width = 700 ,
            height = 400;

            // set the ranges
            var x = d3.scaleBand()
            .range([0, width/2])
            .padding(0.1);
            var y = d3.scaleLinear()
            .range([height, 0]);

            // append the svg object to the body of the page
            // append a 'group' element to 'svg'
            // moves the 'group' element to the top left margin
            var svg = d3.select(".world").append("svg")
            .attr("width", width)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

            // get the data
            d3.csv("sales.csv", function(error, data) {
              if (error) throw error;

              // format the data
              data.forEach(function(d) {
                d.tweet_volume = +d.tweet_volume;
              });

              // Scale the range of the data in the domains
              x.domain(data.map(function(d) { return d.state; }));
              y.domain([0, d3.max(data, function(d) { return d.tweet_volume; })]);

              // append the rectangles for the bar chart
              svg.selectAll(".bar")
              .data(data)
              .enter().append("rect")
              .attr("class", "bar")
              .attr("x", function(d) { return x(d.state); })
              .attr("width", x.bandwidth())
              .attr("y", function(d) { return y(d.tweet_volume); })
              .attr("height", function(d) { return height - y(d.tweet_volume); });

              // add the x Axis
              svg.append("g")
              .attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(x));

              // add the y Axis
              svg.append("g")
              .call(d3.axisLeft(y));

            });


            </script>

          </div>
        </div>
      </div>

    </body>
    </html>
